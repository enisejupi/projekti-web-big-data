# Spark Configuration for High-Performance Cluster
# Optimized for 10 VMs with ~150GB RAM each

# Master Configuration
spark.master                                spark://10.0.0.4:7077
spark.master.port                           7077
spark.master.webui.port                     9090

# Executor Configuration - Optimized for 150GB RAM VMs
spark.executor.memory                       130g
spark.executor.cores                        16
spark.executor.instances                    9
spark.driver.memory                         120g
spark.driver.cores                          16
spark.driver.maxResultSize                  20g

# Memory Management
spark.memory.fraction                       0.8
spark.memory.storageFraction                0.3
spark.memory.offHeap.enabled                true
spark.memory.offHeap.size                   20g

# Network and Shuffle
spark.network.timeout                       800s
spark.executor.heartbeatInterval            60s
spark.shuffle.service.enabled               true
spark.shuffle.file.buffer                   1m
spark.reducer.maxSizeInFlight               96m
spark.shuffle.compress                      true
spark.shuffle.spill.compress                true

# Parallelism - Maximize CPU usage
spark.default.parallelism                   256
spark.sql.shuffle.partitions                256
spark.sql.adaptive.enabled                  true
spark.sql.adaptive.coalescePartitions.enabled   true

# Performance Tuning
spark.speculation                           true
spark.speculation.multiplier                3
spark.speculation.quantile                  0.9
spark.task.maxFailures                      8
spark.stage.maxConsecutiveAttempts         10

# Streaming Configuration
spark.streaming.backpressure.enabled        true
spark.streaming.receiver.maxRate            10000
spark.streaming.kafka.maxRatePerPartition   5000
spark.streaming.stopGracefullyOnShutdown    true

# Checkpointing
spark.streaming.checkpoint.interval         60s
spark.cleaner.ttl                           86400

# Dynamic Allocation
spark.dynamicAllocation.enabled             true
spark.dynamicAllocation.minExecutors        5
spark.dynamicAllocation.maxExecutors        9
spark.dynamicAllocation.initialExecutors    9

# Serialization
spark.serializer                            org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max             512m

# Event Log
spark.eventLog.enabled                      true
spark.eventLog.dir                          /opt/spark/logs
spark.history.fs.logDirectory               /opt/spark/logs

# UI Configuration
spark.ui.enabled                            true
spark.ui.port                               9090
spark.ui.reverseProxy                       true
spark.ui.reverseProxyUrl                    http://185.182.158.150:443

# Python Configuration
spark.python.worker.memory                  4g
spark.python.worker.reuse                   true

# Application Name
spark.app.name                              FinancialAssetAnalysis

# Local Directory
spark.local.dir                             /tmp/spark
